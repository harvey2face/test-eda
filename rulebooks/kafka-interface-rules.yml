---
- name: Demo rules with kafka as source
  hosts: all
  sources:
  - ansible.eda.kafka:
      topic: telegraf
      host: 10.255.4.221
      port: 9092
      group_id:
  rules:
    - name: Display Data and Launch Playbook
      condition: event.body is search('interface-notif-state-down',ignorecase=true)
      action:
        - set_fact:
            json_body: "{{ event.body | regex_replace('([^=]+)=(\\\"[^\\\"]+\\\")', '\\1=\\2') | regex_replace('([^,]+)=([^,]+)', '\"\\1\":\\2') | from_json }}"
        - set_fact:
            structured_data: "{{ json_body | combine({'organization': 'vem'}) }}"
        - run_job_template:
            name: enable_port.yml